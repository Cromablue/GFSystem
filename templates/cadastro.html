{% extends 'base.html' %}

{% block title %}Cadastro{% endblock %}

{% block content %}
<div class="container-fluid h-100">
    <div class="row h-100 align-items-center">
        <!-- Lado esquerdo (Formulário de Cadastro) -->
        <div class="col-md-6 d-flex flex-column justify-content-center align-items-center p-5 ">
            <h1 class="text-center mb-4">Cadastro</h1>
            <form method="POST" class="mx-auto p-4 rounded shadow-sm w-100" id="registerForm" >
                {% csrf_token %}

                <!-- Campo Nome de Usuário -->
                <div class="mb-3">
                    <label for="id_username" class="form-label">Nome de Usuário</label>
                    <input 
                        type="text" 
                        id="id_username" 
                        name="username" 
                        class="form-control" 
                        placeholder="Digite seu nome de usuário" 
                        required>
                    <div class="invalid-feedback">
                        Nome de usuário não pode conter espaços ou caracteres especiais.
                    </div>
                </div>

                <!-- Campo Senha -->
                <div class="mb-3">
                    <label for="id_password1" class="form-label">Senha</label>
                    <div class="input-group">
                        <input 
                            type="password" 
                            id="id_password1" 
                            name="password1" 
                            class="form-control" 
                            placeholder="Crie sua senha" 
                            required>
                        <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#passwordModal">
                            Requisitos
                        </button>
                    </div>
                    <div class="invalid-feedback">
                        A senha deve ter pelo menos 8 caracteres, incluir uma letra maiúscula, um número e um caractere especial.
                    </div>
                </div>

                <!-- Campo Confirmar Senha -->
                <div class="mb-3">
                    <label for="id_password2" class="form-label">Confirme a Senha</label>
                    <input 
                        type="password" 
                        id="id_password2" 
                        name="password2" 
                        class="form-control" 
                        placeholder="Confirme sua senha" 
                        required>
                    <div class="invalid-feedback">
                        As senhas não coincidem.
                    </div>
                </div>

                <!-- Botão de Cadastro -->
                <button type="submit" class="btn btn-success w-100 py-2">Cadastrar</button>
            </form>

            <!-- Link para Login -->
            <div class="mt-3 text-center" >
                <p>
                    Já tem conta? 
                    <a href="{% url 'login' %}" class="btn btn-primary w-100 py-2">Login</a>
                </p>
            </div>
        </div>

        <!-- Lado direito (Seção de boas-vindas) -->
        <div class="col-md-6 d-flex flex-column justify-content-center align-items-center p-5 ">
            <h1 class="mb-4">Bem-vindo</h1>
            <p class="px-4">
                Crie sua conta e gerencie suas faltas e anotações de forma prática e eficiente. 
                Utilize nossos recursos para manter controle e organização.
            </p>
        </div>
    </div>

    <!-- Modal para Requisitos de Senha -->
    <div class="modal fade" id="passwordModal" tabindex="-1" aria-labelledby="passwordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="passwordModalLabel">Requisitos de Senha</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul>
                        <li>Deve ter pelo menos 8 caracteres.</li>
                        <li>Deve incluir pelo menos uma letra maiúscula.</li>
                        <li>Deve incluir pelo menos um número.</li>
                        <li>Deve incluir pelo menos um caractere especial (ex: @, #, $, etc.).</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script de Validação -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("registerForm");

        form.addEventListener("submit", (event) => {
            let isValid = true;

            // Validação do Nome de Usuário
            const username = document.getElementById("id_username");
            const usernameRegex = /^[a-zA-Z0-9]+$/; // Apenas letras e números
            if (!usernameRegex.test(username.value)) {
                username.classList.add("is-invalid");
                isValid = false;
            } else {
                username.classList.remove("is-invalid");
            }

            // Validação da Senha
            const password1 = document.getElementById("id_password1");
            const passwordRegex = /^(?=.*[A-Z])(?=.*\d)(?=.*[@#$%^&+=]).{8,}$/;
            if (!passwordRegex.test(password1.value)) {
                password1.classList.add("is-invalid");
                isValid = false;
            } else {
                password1.classList.remove("is-invalid");
            }

            // Confirmação da Senha
            const password2 = document.getElementById("id_password2");
            if (password1.value !== password2.value) {
                password2.classList.add("is-invalid");
                isValid = false;
            } else {
                password2.classList.remove("is-invalid");
            }

            // Impedir o envio se houver erros
            if (!isValid) {
                event.preventDefault();
            }
        });
    });
</script>
{% endblock %}
